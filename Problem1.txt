BEGIN TRANSACTION;

drop TABLE User;
drop TABLE Borrower;
drop TABLE Lender;
drop TABLE Intermediary; 
drop TABLE Loan;
drop TABLE Trust;
drop TABLE Deadline;
drop TABLE Repayment;
drop TABLE LoanRequest;
drop TABLE Commitment;
drop TABLE IsA;
drop TABLE requests;

CREATE TABLE User(
  userId CHAR(16) PRIMARY KEY NOT NULL,
  name CHAR(64),
  address CHAR(64)
);

CREATE TABLE IsA(
  userId CHAR(16),
  FOREIGN KEY (userId) REFERENCES User(userId)
);

CREATE TABLE Borrower(
  userIdBorrower CHAR(16) NOT NULL,
  FOREIGN KEY (userIdBorrower) REFERENCES IsA(userId)
);

CREATE TABLE Lender(
  userIdLender CHAR(16),
  FOREIGN KEY (userIdLender) REFERENCES IsA(userId)
);

CREATE TABLE Intermediary(
  userIdInter CHAR(16),
  FOREIGN KEY (userIdInter) REFERENCES IsA(userId)
);

CREATE TABLE Loan(
  loanDate DATE PRIMARY KEY,
  requestDate DATE,
  userIdInter CHAR(16),
  FOREIGN KEY (requestDate) REFERENCES LoanRequest(loanDate)
  FOREIGN KEY (userIdInter) REFERENCES Intermediary(userIdInter)
);

CREATE TABLE Trust(
  userIdBorrower CHAR(16),
  value INT PRIMARY KEY,
  FOREIGN KEY (userIdBorrower) REFERENCES Borrower(userIdBorrower)
);

CREATE TABLE Deadline(
  deadline DATE,
  finalDate DATE PRIMARY KEY NOT NULL,
  loanDate DATE,
  FOREIGN KEY (loanDate) REFERENCES Loan(loanDate)
);

CREATE TABLE Repayment(
	date DATE PRIMARY KEY,
	amount DOUBLE,
	loanDate DATE,
	FOREIGN KEY (loanDate) REFERENCES Loan(loanDate)
);

CREATE TABLE LoanRequest(
  requestDate DATE PRIMARY KEY,
  deadline DATE,
  payDate DATE,
  amount DOUBLE,
  description CHAR(128),
  userIdBorrower CHAR(16),
  FOREIGN KEY (userIdBorrower) REFERENCES requests(userIdBorrower)
);

CREATE TABLE Commitment(
	amount DOUBLE PRIMARY KEY,
	userIdLender CHAR(16),
  FOREIGN KEY (userIdLender) REFERENCES Lender(userIdLender)
);



CREATE TABLE requests(
  value INT PRIMARY KEY,
  userIdBorrower CHAR(16),
  userIdLender CHAR(16),
  FOREIGN KEY (userIdBorrower) REFERENCES Borrower(userIdBorrower),
  FOREIGN KEY (userIdLender) REFERENCES Lender(userIdLender)
);

INSERT INTO User VALUES('sgurgu', 'Stefan', 'Tanglewood Drive');
select * from User;


COMMIT;



